-- Combined GUI + Instant Proximity + AutoBox + God Mode + Unload + Cheats Tab with toggles

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CustomGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Toggle Button (Top Center)
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 100, 0, 30)
toggleButton.Position = UDim2.new(0.5, -50, 0, 10)
toggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleButton.TextColor3 = Color3.fromRGB(255, 0, 0)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 16
toggleButton.Text = "Open GUI"
toggleButton.Parent = screenGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 6)
toggleCorner.Parent = toggleButton

-- Main Frame (Hidden by default)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 250, 0, 300)
mainFrame.Position = UDim2.new(0.5, -125, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- Tab Buttons Container
local tabContainer = Instance.new("Frame")
tabContainer.Size = UDim2.new(1, -20, 0, 40)
tabContainer.Position = UDim2.new(0, 10, 0, 10)
tabContainer.BackgroundTransparency = 1
tabContainer.Parent = mainFrame

local function createTabButton(name, positionX)
    local btn = Instance.new("TextButton")
    btn.Name = name .. "TabBtn"
    btn.Size = UDim2.new(0, 110, 1, 0)
    btn.Position = UDim2.new(0, positionX, 0, 0)
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    btn.TextColor3 = Color3.fromRGB(255, 0, 0)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.Text = name
    btn.Parent = tabContainer

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = btn

    return btn
end

local mainTabBtn = createTabButton("Main", 0)
local cheatsTabBtn = createTabButton("Cheats", 120)

-- ===== Main Tab Frame =====
local mainTabFrame = Instance.new("Frame")
mainTabFrame.Size = UDim2.new(1, -20, 1, -60)
mainTabFrame.Position = UDim2.new(0, 10, 0, 50)
mainTabFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
mainTabFrame.BorderSizePixel = 0
mainTabFrame.Parent = mainFrame

local mainTabCorner = Instance.new("UICorner")
mainTabCorner.CornerRadius = UDim.new(0, 8)
mainTabCorner.Parent = mainTabFrame

local mainTitle = Instance.new("TextLabel")
mainTitle.Size = UDim2.new(1, 0, 0, 40)
mainTitle.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainTitle.BorderSizePixel = 0
mainTitle.Text = "Main"
mainTitle.TextColor3 = Color3.fromRGB(255, 0, 0)
mainTitle.Font = Enum.Font.GothamBold
mainTitle.TextSize = 22
mainTitle.Parent = mainTabFrame

local mainTitleCorner = Instance.new("UICorner")
mainTitleCorner.CornerRadius = UDim.new(0, 8)
mainTitleCorner.Parent = mainTitle

-- Button Creator for main tab
local function createMainButton(name, order)
	local button = Instance.new("TextButton")
	button.Name = name
	button.Size = UDim2.new(1, -20, 0, 40)
	button.Position = UDim2.new(0, 10, 0, 50 + ((order - 1) * 50))
	button.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	button.TextColor3 = Color3.fromRGB(255, 0, 0)
	button.Font = Enum.Font.Gotham
	button.TextSize = 18
	button.Text = name
	button.Parent = mainTabFrame
	
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 6)
	corner.Parent = button
	
	return button
end

-- Create Buttons in Main Tab
local button1 = createMainButton("Instant Proximity", 1)
local button2 = createMainButton("AutoBox", 2)
local button3 = createMainButton("God Mode", 3)
local button4 = createMainButton("Unload Script", 4)

-- ===== Cheats Tab Frame =====
local cheatsTabFrame = Instance.new("Frame")
cheatsTabFrame.Size = UDim2.new(1, -20, 1, -60)
cheatsTabFrame.Position = UDim2.new(0, 10, 0, 50)
cheatsTabFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
cheatsTabFrame.BorderSizePixel = 0
cheatsTabFrame.Visible = false -- start hidden
cheatsTabFrame.Parent = mainFrame

local cheatsCorner = Instance.new("UICorner")
cheatsCorner.CornerRadius = UDim.new(0, 8)
cheatsCorner.Parent = cheatsTabFrame

local cheatsTitle = Instance.new("TextLabel")
cheatsTitle.Size = UDim2.new(1, 0, 0, 40)
cheatsTitle.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
cheatsTitle.BorderSizePixel = 0
cheatsTitle.Text = "Cheats"
cheatsTitle.TextColor3 = Color3.fromRGB(255, 0, 0)
cheatsTitle.Font = Enum.Font.GothamBold
cheatsTitle.TextSize = 22
cheatsTitle.Parent = cheatsTabFrame

local cheatsTitleCorner = Instance.new("UICorner")
cheatsTitleCorner.CornerRadius = UDim.new(0, 8)
cheatsTitleCorner.Parent = cheatsTitle

-- Button Creator for cheats tab toggles
local function createCheatToggle(name, order)
    local btn = Instance.new("TextButton")
    btn.Name = name .. "Toggle"
    btn.Size = UDim2.new(1, -20, 0, 40)
    btn.Position = UDim2.new(0, 10, 0, 50 + (order - 1) * 50)
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 16
    btn.Text = name .. " [OFF]"
    btn.Parent = cheatsTabFrame

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = btn

    return btn
end

-- Create cheats toggles
local toggleStaminaBtn = createCheatToggle("Infinite Stamina", 1)
local toggleWalkSpeedBtn = createCheatToggle("Walk Speed", 2)
local toggleJumpBtn = createCheatToggle("Infinite Jump", 3)
local toggleFlyBtn = createCheatToggle("Fly", 4)

-- Variables to track states
local staminaEnabled = false
local speedEnabled = false
local jumpEnabled = false
local flyEnabled = false

local jumpConn
local flyLoop

local defaultWalkSpeed = 16

-- ===== Implement Main Buttons =====

-- Instant Proximity
local instantEnabled = false
local promptWatcher

button1.MouseButton1Click:Connect(function()
	instantEnabled = not instantEnabled
	if instantEnabled then
		button1.Text = "Instant Proximity [ON]"
		for _, prompt in ipairs(workspace:GetDescendants()) do
			if prompt:IsA("ProximityPrompt") then
				prompt.HoldDuration = 0
			end
		end
		promptWatcher = workspace.DescendantAdded:Connect(function(desc)
			if desc:IsA("ProximityPrompt") then
				desc.HoldDuration = 0
			end
		end)
	else
		button1.Text = "Instant Proximity [OFF]"
		for _, prompt in ipairs(workspace:GetDescendants()) do
			if prompt:IsA("ProximityPrompt") then
				prompt.HoldDuration = 1
			end
		end
		if promptWatcher then promptWatcher:Disconnect() end
	end
end)

-- AutoBox
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

local running = false

local function waitForCharacter()
	character = player.Character or player.CharacterAdded:Wait()
	humanoidRootPart = character:WaitForChild("HumanoidRootPart")
end

local function firePrompt(prompt)
	if not prompt then return false end
	if prompt.Enabled and prompt.HoldDuration == 0 then
		prompt:InputHoldBegin()
		task.wait(0.2)
		prompt:InputHoldEnd()
		return true
	end
	return false
end

button2.MouseButton1Click:Connect(function()
	running = not running
	if running then
		button2.Text = "AutoBox [ON]"
		task.spawn(function()
			while running and player.Character and player.Character:FindFirstChild("HumanoidRootPart") do
				for _, prompt in ipairs(workspace:GetDescendants()) do
					if prompt:IsA("ProximityPrompt") and prompt.Name == "BoxPrompt" then
						-- Move to the prompt's parent position
						local target = prompt.Parent and prompt.Parent:IsA("BasePart") and prompt.Parent or nil
						if target then
							humanoidRootPart.CFrame = target.CFrame + Vector3.new(0, 3, 0)
							firePrompt(prompt)
							task.wait(0.3)
						end
					end
				end
				task.wait(0.5)
			end
		end)
	else
		button2.Text = "AutoBox [OFF]"
	end
end)

-- God Mode
local godMode = false
local humanoid = character:WaitForChild("Humanoid")

button3.MouseButton1Click:Connect(function()
	godMode = not godMode
	if godMode then
		button3.Text = "God Mode [ON]"
		if humanoid then
			humanoid.MaxHealth = math.huge
			humanoid.Health = humanoid.MaxHealth
		end
	else
		button3.Text = "God Mode [OFF]"
		if humanoid then
			humanoid.MaxHealth = 100
			humanoid.Health = humanoid.MaxHealth
		end
	end
end)

-- Unload Script
button4.MouseButton1Click:Connect(function()
	screenGui:Destroy()
	toggleButton:Destroy()
end)

-- ===== Tabs Switching =====
mainTabBtn.MouseButton1Click:Connect(function()
	mainTabFrame.Visible = true
	cheatsTabFrame.Visible = false
	mainTabBtn.TextColor3 = Color3.fromRGB(255, 0, 0)
	cheatsTabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
end)

cheatsTabBtn.MouseButton1Click:Connect(function()
	mainTabFrame.Visible = false
	cheatsTabFrame.Visible = true
	mainTabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	cheatsTabBtn.TextColor3 = Color3.fromRGB(255, 0, 0)
end)

-- ===== Player =====

-- Infinite Stamina (for example purposes, sets Humanoid's stamina if available)
toggleStaminaBtn.MouseButton1Click:Connect(function()
	staminaEnabled = not staminaEnabled
	if staminaEnabled then
		toggleStaminaBtn.Text = "Infinite Stamina [ON]"
		-- Example: If stamina system exists
		if humanoid and humanoid:FindFirstChild("Stamina") then
			RunService:BindToRenderStep("StaminaRestore", 200, function()
				humanoid.Stamina.Value = humanoid.Stamina.MaxValue
			end)
		end
	else
		toggleStaminaBtn.Text = "Infinite Stamina [OFF]"
		RunService:UnbindFromRenderStep("StaminaRestore")
	end
end)

-- Walk Speed
toggleWalkSpeedBtn.MouseButton1Click:Connect(function()
	speedEnabled = not speedEnabled
	if speedEnabled then
		toggleWalkSpeedBtn.Text = "Walk Speed [ON]"
		if humanoid then
			humanoid.WalkSpeed = 50
		end
	else
		toggleWalkSpeedBtn.Text = "Walk Speed [OFF]"
		if humanoid then
			humanoid.WalkSpeed = defaultWalkSpeed
		end
	end
end)

-- Infinite Jump
toggleJumpBtn.MouseButton1Click:Connect(function()
	jumpEnabled = not jumpEnabled
	if jumpEnabled then
		toggleJumpBtn.Text = "Infinite Jump [ON]"
		jumpConn = UserInputService.JumpRequest:Connect(function()
			if humanoid and humanoid:GetState() ~= Enum.HumanoidStateType.Dead then
				humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
			end
		end)
	else
		toggleJumpBtn.Text = "Infinite Jump [OFF]"
		if jumpConn then
			jumpConn:Disconnect()
			jumpConn = nil
		end
	end
end)

-- Fly (basic fly toggle)
toggleFlyBtn.MouseButton1Click:Connect(function()
	flyEnabled = not flyEnabled
	if flyEnabled then
		toggleFlyBtn.Text = "Fly [ON]"
		local bodyGyro = Instance.new("BodyGyro")
		bodyGyro.P = 9e4
		bodyGyro.MaxTorque = Vector3.new(9e4, 9e4, 9e4)
		bodyGyro.CFrame = humanoidRootPart.CFrame
		bodyGyro.Parent = humanoidRootPart

		local bodyVelocity = Instance.new("BodyVelocity")
		bodyVelocity.Velocity = Vector3.new(0,0,0)
		bodyVelocity.MaxForce = Vector3.new(9e4, 9e4, 9e4)
		bodyVelocity.Parent = humanoidRootPart

		flyLoop = RunService.Heartbeat:Connect(function()
			local moveDirection = humanoid.MoveDirection
			local upDown = 0
			if UserInputService:IsKeyDown(Enum.KeyCode.E) then
				upDown = 1
			elseif UserInputService:IsKeyDown(Enum.KeyCode.Q) then
				upDown = -1
			end

			local velocity = moveDirection * 50 + Vector3.new(0, upDown * 50, 0)
			bodyVelocity.Velocity = velocity
			bodyGyro.CFrame = workspace.CurrentCamera.CFrame
		end)

		-- Prevent fall damage by changing humanoid state
		humanoid.PlatformStand = false

	else
		toggleFlyBtn.Text = "Fly [OFF]"
		if flyLoop then
			flyLoop:Disconnect()
			flyLoop = nil
		end
		for _, obj in pairs(humanoidRootPart:GetChildren()) do
			if obj:IsA("BodyGyro") or obj:IsA("BodyVelocity") then
				obj:Destroy()
			end
		end
		humanoid.PlatformStand = false
	end
end)

-- ===== Toggle GUI Button =====
toggleButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
	toggleButton.Text = mainFrame.Visible and "Close GUI" or "Open GUI"
end)
